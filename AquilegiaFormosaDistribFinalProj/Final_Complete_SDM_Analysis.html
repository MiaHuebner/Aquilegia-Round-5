<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mia Huebner">

<title>SDM Analysis!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Final_Complete_SDM_Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final_Complete_SDM_Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Final_Complete_SDM_Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Final_Complete_SDM_Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final_Complete_SDM_Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final_Complete_SDM_Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final_Complete_SDM_Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final_Complete_SDM_Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final_Complete_SDM_Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final_Complete_SDM_Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SDM Analysis!</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mia Huebner </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="sdm-analysis" class="level2">
<h2 class="anchored" data-anchor-id="sdm-analysis">SDM Analysis!</h2>
<p>With the the initial idea of the distribution of <em>Aquilegia formosa,</em> along with the generated pseudo-absence points, and the spatial blocks, the spatial distribution model analysis can begin! This workflow is adapted from Damaris Zurrell’s 2020 “Introduction to species distribution modelling (SDM) in R”. In this workflow, however, the ‘geodata’ package is used to access WorldClim data as well as the ‘terra’ package intead of ‘raster’.</p>
<p>As always, start by loading your libraries, I used a LOT for this one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'geodata' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: terra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'terra' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:terra':

    intersect, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'devtools' was built under R version 4.4.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: usethis</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'usethis' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mecofun)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'randomForest' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'randomForest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brglm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'brglm2' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.2, GDAL 3.8.2, PROJ 9.3.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tmap' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Breaking News: tmap 3.x is retiring. Please test v4, e.g. with
remotes::install_github('r-tmap/tmap')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blockCV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'blockCV' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>blockCV 3.1.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(curl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'curl' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using libcurl 8.10.1 with Schannel</code></pre>
</div>
</div>
<p>Now, load in the necessary data, starting with the WorldClim data. The data I specifically wanted to download were Bio 2, 5, and 14. Bio 2 is the mean diurnal range, which is the difference between the maximum temperature and the minimum temperature in a month. Bio 5 is the current maximum temperature of the warmest month, and Bio 14 is the precipitation data of the driest month. These variables were chosen as <em>Aquilegia formosa</em> is not drought resistant and is also negatively affected by high temperatures.</p>
<p>In this code block, make sure to change the pathway to a place in your computer, and switch the download to TRUE! :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Global_Current_Data <span class="ot">&lt;-</span> <span class="fu">worldclim_global</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">'bio'</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">5</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">'C:/Users/Mia/OneDrive/Desktop/RWorkPLUS/GISR/FinalProject/AquilegiaFormosaDistribFinalProj/CurrentWorldClim'</span>, <span class="co">#Change this line of code to download the data onto your own computer </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">download =</span> <span class="cn">FALSE</span>)[[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">14</span>)]]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Global_Current_Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: [summary] used a sample</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> wc2.1_5m_bio_2  wc2.1_5m_bio_5   wc2.1_5m_bio_14
 Min.   : 1.00   Min.   :-29.60   Min.   :  0    
 1st Qu.: 7.44   1st Qu.: -6.44   1st Qu.:  0    
 Median : 9.42   Median : 21.54   Median :  5    
 Mean   :10.00   Mean   : 13.85   Mean   : 15    
 3rd Qu.:12.40   3rd Qu.: 31.39   3rd Qu.: 18    
 Max.   :20.71   Max.   : 48.20   Max.   :474    
 NA's   :66240   NA's   :66240    NA's   :66240  </code></pre>
</div>
</div>
<p>Now, load in the future climate projections according to the Canadian Earth System Model (CanESM5). This model works well with extreme precipitation and temperature values, which is somewhat common in mountainous regions (where <em>Aquilegia formosa</em> is found). It also uses a lower resolution, which is good considering the large area in this analysis. The “ssp = 245” section of the code represents a middle socioeconomic pathway, gathering data assuming that moderate efforts are taken to reduce emissions, however there will still be significant climate change by 2100. The projected findings will reflect the 2021-2040 time period. For both the current and future climate data, the second lowest resolution (5) was chosen.</p>
<p>Again, make sure to change the pathway to a place in your computer, and switch the download to TRUE! :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>US_Cnda_Mxco_Bio_Future_Data <span class="ot">&lt;-</span> <span class="fu">cmip6_world</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">lon =</span> <span class="sc">-</span><span class="fl">131.5</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fl">46.5</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">'bioc'</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ssp =</span> <span class="dv">245</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">5</span>, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rcp =</span> <span class="dv">45</span>, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">'CanESM5'</span>, </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">"2021-2040"</span>, </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">'C:/Users/Mia/OneDrive/Desktop/RWorkPLUS/GISR/FinalProject/AquilegiaFormosaDistribFinalProj'</span>, </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">download =</span> <span class="cn">FALSE</span>)[[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">14</span>)]]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(US_Cnda_Mxco_Bio_Future_Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: [summary] used a sample</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     bio02           bio05            bio14       
 Min.   : 0.20   Min.   :-27.90   Min.   :  0.00  
 1st Qu.: 7.30   1st Qu.: -5.00   1st Qu.:  0.00  
 Median : 9.40   Median : 25.00   Median :  5.00  
 Mean   : 9.85   Mean   : 16.68   Mean   : 14.97  
 3rd Qu.:12.30   3rd Qu.: 34.00   3rd Qu.: 18.50  
 Max.   :20.90   Max.   : 50.50   Max.   :476.30  
 NA's   :67539   NA's   :67539    NA's   :67539   </code></pre>
</div>
</div>
<p>Load in the <em>Aquilegia formosa</em> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Data_D <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/MiaHuebner/Aquilegia-Distribution-Final-Project/refs/heads/main/Final_SDM_Data_Complete.txt"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>Final_SDM_Data_Complete <span class="ot">&lt;-</span> <span class="fu">read.table</span>(Data_D, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Aquilegia_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Final_SDM_Data_Complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, generate a background map of the US, Canada, and Mexico.</p>
<p>Again, make sure to change the pathway to a place in your computer! :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>North_America_Boundary <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">gadm</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"USA"</span>, <span class="st">"Canada"</span>, <span class="st">"Mexico"</span>), </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="dv">0</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">tempdir</span>(<span class="st">'C:/Users/Mia/OneDrive/Desktop/RWorkPLUS/GISR/FinalProject/AquilegiaFormosaDistribFinalProj'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, create an empty raster with the extent of US, Canada, and Mexico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>raster_of_the_three <span class="ot">&lt;-</span> <span class="fu">rast</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ext</span>(North_America_Boundary), </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resolution =</span> <span class="fl">0.5</span>, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="fu">crs</span>(North_America_Boundary)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a mask:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(North_America_Boundary, raster_of_the_three)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>NA_coords <span class="ot">&lt;-</span> <span class="fu">ext</span>(<span class="sc">-</span><span class="dv">175</span>, <span class="sc">-</span><span class="dv">50</span>, <span class="dv">5</span>, <span class="dv">90</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">crop</span>(mask, NA_coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Crop the WorldClim data to only the areas Aquilegia is found by first setting the range of <em>Aquilegia formosa:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Aquilegia_Range_Longitude <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">155</span><span class="sc">:-</span><span class="dv">108</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Aquilegia_Range_Latitude <span class="ot">&lt;-</span> <span class="dv">29</span><span class="sc">:</span><span class="dv">66</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>Aquilegia_Range <span class="ot">&lt;-</span> <span class="fu">ext</span>(<span class="fu">min</span>(Aquilegia_Range_Longitude), </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">max</span>(Aquilegia_Range_Longitude),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">min</span>(Aquilegia_Range_Latitude), </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">max</span>(Aquilegia_Range_Latitude))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, first focus on the current climate data. Make sure it is projected to the North American coordinate system and focused on the US, Canada, and Mexico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Current_Bio <span class="ot">&lt;-</span> <span class="fu">crop</span>(Global_Current_Data, Aquilegia_Range)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>Current_Bio <span class="ot">&lt;-</span> <span class="fu">project</span>(Current_Bio, mask)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>Current_Bio <span class="ot">&lt;-</span> <span class="fu">resample</span>(Current_Bio, mask)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>Current_Bio <span class="ot">&lt;-</span> <span class="fu">mask</span>(Current_Bio, mask)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Current_Bio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Current.Mean.Diurnal.Range..Bio.2.'</span>, </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'Current.Max..Temp..of.Warmest.Month..Bio.5.'</span>, </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'Current.Driest.Month.Precipitation.Data..Bio.14.'</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The temperature values are multiplied by 10 in WorldClim, so let’s change them back to normal Celsius:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>Current_Bio[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> Current_Bio[[<span class="dv">1</span>]]<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Current_Bio[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> Current_Bio[[<span class="dv">2</span>]]<span class="sc">/</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see how the current data look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Current_Bio,<span class="at">ext =</span> Aquilegia_Range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Repeat the steps that were just executed for the current climate data for the future climate data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>Future_Bio <span class="ot">&lt;-</span> <span class="fu">crop</span>(US_Cnda_Mxco_Bio_Future_Data, Aquilegia_Range)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>Future_Bio <span class="ot">&lt;-</span> <span class="fu">project</span>(Future_Bio, mask)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>Future_Bio <span class="ot">&lt;-</span> <span class="fu">resample</span>(Future_Bio, mask)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>Future_Bio <span class="ot">&lt;-</span> <span class="fu">mask</span>(Future_Bio, mask)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Future_Bio) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Current.Mean.Diurnal.Range..Bio.2.'</span>, <span class="st">'Current.Max..Temp..of.Warmest.Month..Bio.5.'</span>, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Current.Driest.Month.Precipitation.Data..Bio.14.'</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>Future_Bio[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> Future_Bio[[<span class="dv">1</span>]]<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>Future_Bio[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> Future_Bio[[<span class="dv">2</span>]]<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>Future_Bio[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> Future_Bio[[<span class="dv">3</span>]]<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Future_Bio, <span class="at">ext =</span> Aquilegia_Range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cool! The current versus the future climate projections look very similar, this could be due to the time frame chosen for the future projections (2021-2040). This could also be due to choosing a moderate societal emission prediction (ssp = 245).</p>
<p>Let’s continue with the analysis.</p>
<p>Since the data set is so large, let’s only focus on observations collected in the last year (2023 or more recent). This should help with the model fitting as only 1750 pseudo-absences were generated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>LastYearData <span class="ot">&lt;-</span> Aquilegia_df <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2023</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>LastYearData_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(LastYearData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this species distribution model analysis, I am using the Generalized Linear Model (GLM). This model is one of the most common models in species distribution modelling and is relatively simple. It does, however, require absence data, which is why pseudo-absence data was generated through a different workflow. When performing this model, watch for multi-colinearity issues that can arise. To check if this would be an issue, I referenced a table with r correlation coefficients (Pearson correlation coefficient) between the different Bioclimatic data sets provided by WorldClim (Kumari et al., 2022). If r &gt; 0.7 between any combination of the bioclimatic variables, multi-colinearity would have been an issue, however, r &lt;&lt; 0.7 for all combinations of Bio 2, 5, and 14.</p>
<p>Let’s begin by fitting the model to the data by just using the basic glm() function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>m_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(presence <span class="sc">~</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>               Current.Mean.Diurnal.Range..Bio.<span class="fl">2.</span> <span class="sc">+</span> <span class="fu">I</span>(Current.Mean.Diurnal.Range..Bio.<span class="fl">2.</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>               Current.Max..Temp..of.Warmest.Month..Bio.<span class="fl">5.</span> <span class="sc">+</span> <span class="fu">I</span>(Current.Max..Temp..of.Warmest.Month..Bio.<span class="fl">5.</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>               Current.Driest.Month.Precipitation.Data..Bio.<span class="fl">14.</span> <span class="sc">+</span> <span class="fu">I</span>(Current.Driest.Month.Precipitation.Data..Bio.<span class="fl">14.</span><span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> LastYearData_df) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = presence ~ Current.Mean.Diurnal.Range..Bio.2. + 
    I(Current.Mean.Diurnal.Range..Bio.2.^2) + Current.Max..Temp..of.Warmest.Month..Bio.5. + 
    I(Current.Max..Temp..of.Warmest.Month..Bio.5.^2) + Current.Driest.Month.Precipitation.Data..Bio.14. + 
    I(Current.Driest.Month.Precipitation.Data..Bio.14.^2), family = "binomial", 
    data = LastYearData_df)

Coefficients:
                                                        Estimate Std. Error
(Intercept)                                            4.892e+01  9.185e+03
Current.Mean.Diurnal.Range..Bio.2.                    -1.119e+01  4.229e+03
I(Current.Mean.Diurnal.Range..Bio.2.^2)                4.256e-01  3.359e+02
Current.Max..Temp..of.Warmest.Month..Bio.5.           -1.320e+00  2.354e+03
I(Current.Max..Temp..of.Warmest.Month..Bio.5.^2)       2.683e-02  9.848e+01
Current.Driest.Month.Precipitation.Data..Bio.14.      -2.465e-01  3.846e+02
I(Current.Driest.Month.Precipitation.Data..Bio.14.^2)  9.165e-04  3.157e+00
                                                      z value Pr(&gt;|z|)
(Intercept)                                             0.005    0.996
Current.Mean.Diurnal.Range..Bio.2.                     -0.003    0.998
I(Current.Mean.Diurnal.Range..Bio.2.^2)                 0.001    0.999
Current.Max..Temp..of.Warmest.Month..Bio.5.            -0.001    1.000
I(Current.Max..Temp..of.Warmest.Month..Bio.5.^2)        0.000    1.000
Current.Driest.Month.Precipitation.Data..Bio.14.       -0.001    0.999
I(Current.Driest.Month.Precipitation.Data..Bio.14.^2)   0.000    1.000

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 7.6690e+03  on 6686  degrees of freedom
Residual deviance: 6.2502e-08  on 6680  degrees of freedom
AIC: 14

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
<p>It didn’t converge :(. Let’s try using the “brglmfit” method to coerce the data to fit the model a little better:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>modeltry89 <span class="ot">&lt;-</span> <span class="fu">glm</span>(presence <span class="sc">~</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                    Current.Mean.Diurnal.Range..Bio.<span class="fl">2.</span> <span class="sc">+</span> <span class="fu">I</span>(Current.Mean.Diurnal.Range..Bio.<span class="fl">2.</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                    Current.Max..Temp..of.Warmest.Month..Bio.<span class="fl">5.</span> <span class="sc">+</span> <span class="fu">I</span>(Current.Max..Temp..of.Warmest.Month..Bio.<span class="fl">5.</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                    Current.Driest.Month.Precipitation.Data..Bio.<span class="fl">14.</span> <span class="sc">+</span> <span class="fu">I</span>(Current.Driest.Month.Precipitation.Data..Bio.<span class="fl">14.</span><span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> LastYearData_df, </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"brglmFit"</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modeltry89)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = presence ~ Current.Mean.Diurnal.Range..Bio.2. + 
    I(Current.Mean.Diurnal.Range..Bio.2.^2) + Current.Max..Temp..of.Warmest.Month..Bio.5. + 
    I(Current.Max..Temp..of.Warmest.Month..Bio.5.^2) + Current.Driest.Month.Precipitation.Data..Bio.14. + 
    I(Current.Driest.Month.Precipitation.Data..Bio.14.^2), family = "binomial", 
    data = LastYearData_df, method = "brglmFit")

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.57462  -0.01223   0.01287   0.01741   0.44678  

Coefficients:
                                                        Estimate Std. Error
(Intercept)                                           13.6231519  1.7159271
Current.Mean.Diurnal.Range..Bio.2.                    -2.6515621  0.5640311
I(Current.Mean.Diurnal.Range..Bio.2.^2)                0.0993625  0.0272933
Current.Max..Temp..of.Warmest.Month..Bio.5.           -0.4634464  0.2431617
I(Current.Max..Temp..of.Warmest.Month..Bio.5.^2)       0.0104111  0.0049131
Current.Driest.Month.Precipitation.Data..Bio.14.      -0.0049180  0.0582064
I(Current.Driest.Month.Precipitation.Data..Bio.14.^2) -0.0002766  0.0003334
                                                      z value Pr(&gt;|z|)    
(Intercept)                                             7.939 2.03e-15 ***
Current.Mean.Diurnal.Range..Bio.2.                     -4.701 2.59e-06 ***
I(Current.Mean.Diurnal.Range..Bio.2.^2)                 3.641 0.000272 ***
Current.Max..Temp..of.Warmest.Month..Bio.5.            -1.906 0.056661 .  
I(Current.Max..Temp..of.Warmest.Month..Bio.5.^2)        2.119 0.034086 *  
Current.Driest.Month.Precipitation.Data..Bio.14.       -0.084 0.932665    
I(Current.Driest.Month.Precipitation.Data..Bio.14.^2)  -0.830 0.406738    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 7669.0377  on 6686  degrees of freedom
Residual deviance:    6.5645  on 6680  degrees of freedom
AIC:  20.565

Type of estimator: AS_mixed (mixed bias-reducing adjusted score equations)
Number of Fisher Scoring iterations: 42</code></pre>
</div>
</div>
<p>Nice! Now the model converges. Let’s move to plotting the partial response curves of the model</p>
<p>If you do not have the mecofun package, you can install it through:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_git</span>(<span class="st">"https://gitup.uni-potsdam.de/macroecology/mecofun.git"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Skipping install of 'mecofun' from a xgit remote, the SHA1 (feb82c4a) has not changed since last install.
  Use `force = TRUE` to force installation</code></pre>
</div>
</div>
<p>First, name the variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Current.Mean.Diurnal.Range..Bio.2.'</span>, </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Current.Max..Temp..of.Warmest.Month..Bio.5.'</span>, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Current.Driest.Month.Precipitation.Data..Bio.14.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want to view the curves next to each other, so set three panels next to each other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, plot the partial responses for both the m_glm model, which does not converge, AND the modeltry89 which DOES converge:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partial_response</span>(m_glm, <span class="at">predictors =</span> LastYearData_df[, pred])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partial_response</span>(modeltry89, </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predictors =</span> LastYearData_df[, pred],</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">170</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Both models generate sharp, disconnected partial response curves. To try to troubleshoot this during my analysis, I tried different “Bio” variable combinations from WorldClim, including the combinations of Bio (2, 5, 11), (5, 11, 14), (2, 11, 14), and (2, 5, 11), however each combination looked either worse or the same. Then, thinking it was an over-complication of the model, I simplified it by removing the second square term in the series (I(xxxBio.n^2), however that still did not fix the issue. After trying these different methods to improve the partial response curves, I decided to continue the analysis anyways.</p>
<p>Concerning both models, when looking at the partial response curves, even though the m_glm model does not converge, it still appears to fit the data better than the modeltry89 model that does converge. With this in mind, I chose to switch to the non-convergent m_glm for futher analysis.</p>
<p>Looking at the response surfaces/inflated response curves can provide insight between the interaction between a species and its environment at certain environmental conditions better than simply looking at the partial response curves. Now, let’s move to generating the response surfaces of the partial response curves. Start by preparing a dummy data set, keeping two predictor variables ranging from their minimums to maximums, while holding the third predictor constant at its mean. For this, I ranged climatic variables 2 and 5, and held bio 14 constant at its mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>wxz <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand.grid</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="fu">min</span>(LastYearData_df[, pred[<span class="dv">1</span>]]),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">max</span>(LastYearData_df[, pred[<span class="dv">1</span>]]),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">length =</span> <span class="dv">50</span>),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="fu">min</span>(LastYearData_df[, pred[<span class="dv">2</span>]]), </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">max</span>(LastYearData_df[, pred[<span class="dv">2</span>]]),</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">length =</span> <span class="dv">50</span>), </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(LastYearData_df[, pred[<span class="dv">3</span>]])</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wxz) <span class="ot">&lt;-</span> pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, make the predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>wxz<span class="sc">$</span>z <span class="ot">&lt;-</span> <span class="fu">predict</span>(m_glm, wxz, <span class="at">type =</span> <span class="st">'response'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wxz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Current.Mean.Diurnal.Range..Bio.2. Current.Max..Temp..of.Warmest.Month..Bio.5.
 Min.   : 0.4603                    Min.   : 0.574                             
 1st Qu.: 5.1347                    1st Qu.:11.451                             
 Median :10.0038                    Median :22.781                             
 Mean   :10.0038                    Mean   :22.781                             
 3rd Qu.:14.8730                    3rd Qu.:34.111                             
 Max.   :19.5473                    Max.   :44.988                             
 Current.Driest.Month.Precipitation.Data..Bio.14.       z            
 Min.   :22.51                                    Min.   :0.0000000  
 1st Qu.:22.51                                    1st Qu.:0.0000000  
 Median :22.51                                    Median :0.0000000  
 Mean   :22.51                                    Mean   :0.1564664  
 3rd Qu.:22.51                                    3rd Qu.:0.0000012  
 Max.   :22.51                                    Max.   :1.0000000  </code></pre>
</div>
</div>
<p>Create a color scale for the 3D visualization:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>cls <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">rev</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brewer.pal</span>(<span class="dv">11</span>, <span class="st">'RdYlBu'</span>)))(<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, plot the 3D surface:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wireframe</span>(z <span class="sc">~</span> Current.Mean.Diurnal.Range..Bio.<span class="fl">2.</span> <span class="sc">+</span> Current.Max..Temp..of.Warmest.Month..Bio.<span class="fl">5.</span>, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> wxz, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">zlab =</span> <span class="fu">list</span>(<span class="st">"Occurrence Probability"</span>, <span class="at">rot =</span> <span class="dv">90</span>), </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">drape =</span> <span class="cn">TRUE</span>, </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.regions =</span> cls,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">arrows =</span> <span class="cn">FALSE</span>), </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">zlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">'GLM'</span>, </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">'bio_2'</span>, </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">'bio_5'</span>, </span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">screen =</span> <span class="fu">list</span>(<span class="at">z =</span> <span class="dv">120</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">y =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is a steep response surface.</p>
<p>Plot the inflated response curves of this surface now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inflated_response</span>(m_glm, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">predictors =</span> LastYearData_df[, pred], </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"stat6"</span>, </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">main =</span> <span class="st">'GLM'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>After creating the response surfaces, let’s perform a Random forest (RF) analysis. Random forest analyses generate regression trees and then can average the results from these trees using bootstrap aggregation, estimating variable importance through a permutation procedure.</p>
<p>Let’s start the rf analysis by fitting the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>(m_rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> LastYearData_df[, <span class="fu">c</span>(<span class="st">'Current.Mean.Diurnal.Range..Bio.2.'</span>, <span class="st">'Current.Max..Temp..of.Warmest.Month..Bio.5.'</span>, </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'Current.Driest.Month.Precipitation.Data..Bio.14.'</span>)], </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> LastYearData_df[, <span class="st">'presence'</span>], </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">500</span>, </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nodesize =</span> <span class="dv">10</span>, </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(x = LastYearData_df[, c("Current.Mean.Diurnal.Range..Bio.2.",      "Current.Max..Temp..of.Warmest.Month..Bio.5.", "Current.Driest.Month.Precipitation.Data..Bio.14.")],      y = LastYearData_df[, "presence"], ntree = 500, nodesize = 10,      importance = TRUE) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 1

          Mean of squared residuals: 5.035691e-05
                    % Var explained: 99.97</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>m_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(x = LastYearData_df[, c("Current.Mean.Diurnal.Range..Bio.2.",      "Current.Max..Temp..of.Warmest.Month..Bio.5.", "Current.Driest.Month.Precipitation.Data..Bio.14.")],      y = LastYearData_df[, "presence"], ntree = 500, nodesize = 10,      importance = TRUE) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 1

          Mean of squared residuals: 5.035691e-05
                    % Var explained: 99.97</code></pre>
</div>
</div>
<p>With this output, a high amount of variance is explained (99.97%). Let’s now look at the variable importance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(m_rf, <span class="at">type =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   %IncMSE
Current.Mean.Diurnal.Range..Bio.2.               28.041329
Current.Max..Temp..of.Warmest.Month..Bio.5.      20.226699
Current.Driest.Month.Precipitation.Data..Bio.14.  7.869129</code></pre>
</div>
</div>
<p>Plot!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(m_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is clearly seen that the increase in mean square error (%IncMSE) is highest for the Bio 2 variable. This indicates that it is the more important variable when comparing to Bio 5 and Bio 14.</p>
<p>Let’s look at the single trees:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(getTree</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>     (m_rf, </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>       <span class="dv">1</span>, </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>       <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  left daughter right daughter                                        split var
1             2              3 Current.Driest.Month.Precipitation.Data..Bio.14.
2             4              5               Current.Mean.Diurnal.Range..Bio.2.
3             6              7               Current.Mean.Diurnal.Range..Bio.2.
4             0              0                                             &lt;NA&gt;
5             0              0                                             &lt;NA&gt;
6             8              9      Current.Max..Temp..of.Warmest.Month..Bio.5.
  split point status   prediction
1    1.003532     -3 7.315687e-01
2    5.468839     -3 9.090909e-02
3    3.408041     -3 7.411961e-01
4    0.000000     -1 1.000000e+00
5    0.000000     -1 4.440892e-16
6    2.584373     -3 1.000000e+00</code></pre>
</div>
</div>
<p>To visually understand the model over the entire environment, let’s again look at the partial response curves as well as 3D response surfaces.</p>
<p>Plot the partial response curves again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partial_response</span>(m_rf, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predictors =</span> LastYearData_df[, pred], </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main =</span> <span class="st">'Random Forest'</span>, </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Plot the response surface:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>wxz<span class="sc">$</span>z <span class="ot">&lt;-</span> <span class="fu">predict</span>(m_rf, wxz)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>cls <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">rev</span>(</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brewer.pal</span>(<span class="dv">11</span>, <span class="st">'RdYlBu'</span>)))(<span class="dv">100</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">wireframe</span>(z <span class="sc">~</span> Current.Mean.Diurnal.Range..Bio.<span class="fl">2.</span> <span class="sc">+</span> Current.Max..Temp..of.Warmest.Month..Bio.<span class="fl">5.</span>, </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> wxz, </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">zlab =</span> <span class="fu">list</span>(<span class="st">"Occurrence Probability"</span>, <span class="at">rot =</span> <span class="dv">90</span>), </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">drape =</span> <span class="cn">TRUE</span>, </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.regions =</span> cls, </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">arrows =</span> <span class="cn">FALSE</span>), </span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">zlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">'Random Forest'</span>, </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">'Bio 2'</span>, </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">'Bio 5'</span>, </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">screen =</span> <span class="fu">list</span>(<span class="at">z =</span> <span class="dv">120</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">60</span>, <span class="at">y =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Plot the inflated response curves for the rf:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inflated_response</span>(m_rf, </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">predictors =</span> LastYearData_df[, pred],</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"stat6"</span>, </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lwd =</span> <span class="dv">3</span>, </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">main =</span> <span class="st">'Random Forest'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that the General Linearized Model and Random Forest Models are complete, assess how well the model predicts the occurrence. This is where the generated spatial block tiles come in! To assess the model’s predictive ability, spatial block cross-validation predictions will be performed.</p>
<p>Start with the cross-validation predictions for the GLM:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>crosspred_glm <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">crossvalSDM</span>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  m_glm, </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">traindat =</span> LastYearData_df, </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">colname_pred =</span> pred, </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">colname_species =</span> <span class="st">"presence"</span>, </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">kfold =</span> LastYearData_df[<span class="sc">!</span><span class="fu">is.na</span>(LastYearData_df<span class="sc">$</span>blockCV_tile), <span class="st">'blockCV_tile'</span>]</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
</div>
<p>This warning is saying that the GLM did not converge and may cause issues later. As an attempt to avoid this warning, however, I did run the entire analysis again with the “brglm” GLM model that did converge. When running this with the “brglm” model, the code did not run and continued to give me an error that I could not find a way to avoid. Due to the data set and model fitting issues, this warning is accepted and noted for analyzing the results of the future distribution predictions.</p>
<p>Now, move to the RF cross-validation predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>crosspred_rf <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">crossvalSDM</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  m_rf, </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">traindat =</span> LastYearData_df, </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">colname_pred =</span> pred, </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">colname_species =</span> <span class="st">"presence"</span>, </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">kfold =</span> LastYearData_df[<span class="sc">!</span><span class="fu">is.na</span>(LastYearData_df<span class="sc">$</span>blockCV_tile), <span class="st">'blockCV_tile'</span>]</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?
Warning in randomForest.default(x = LastYearData_df[,
c("Current.Mean.Diurnal.Range..Bio.2.", : The response has five or fewer unique
values.  Are you sure you want to do regression?</code></pre>
</div>
</div>
<p>This code block also generates a warning, saying that five or fewer unique values are produced. Again, this warning was ignored and the regression was continued.</p>
<p>Now, look at the correlation between the GLM and RF predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(crosspred_glm, crosspred_rf, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">'grey35'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This shows a less than ideal correlation.</p>
<p>Assess the cross-validated model performance by measuring the true skill statistic (TSS) along with a few other measures, while estimating an optimal threshold to make binary predictions. The threshold that’s used maximizes the TSS.</p>
<p>Perform this assessment for the GLM:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>(eval_glm <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">evalSDM</span>(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation =</span> LastYearData_df[<span class="sc">!</span><span class="fu">is.na</span>(LastYearData_df<span class="sc">$</span>blockCV_tile), <span class="dv">10</span>], </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictions =</span> crosspred_glm</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  AUC TSS Kappa Sens Spec PCC        D2 thresh
1   1   1     1    1    1   1 0.9998665    0.5</code></pre>
</div>
</div>
<p>Now for the RF:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>(eval_rf <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">evalSDM</span>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation =</span> LastYearData_df[<span class="sc">!</span><span class="fu">is.na</span>(LastYearData_df<span class="sc">$</span>blockCV_tile), <span class="dv">10</span>], </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictions =</span> crosspred_rf</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  AUC TSS Kappa Sens Spec PCC        D2 thresh
1   1   1     1    1    1   1 0.9997455   0.58</code></pre>
</div>
</div>
<p>Now, combine the two SDM algorithm predictions to make an ensemble prediction by taking the median:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>combo_the_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(crosspred_glm, crosspred_rf)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>crosspred_ens <span class="ot">&lt;-</span> <span class="fu">apply</span>(combo_the_data, <span class="dv">1</span>, median)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>(eval_ens <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">evalSDM</span>(</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation =</span> LastYearData_df[<span class="sc">!</span><span class="fu">is.na</span>(LastYearData_df<span class="sc">$</span>blockCV_tile), <span class="dv">10</span>], </span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictions =</span> crosspred_ens</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  AUC TSS Kappa Sens Spec PCC        D2 thresh
1   1   1     1    1    1   1 0.9998085   0.54</code></pre>
</div>
</div>
<p>Note how all values are 1 or nearly 1.</p>
<p>Finally, after fitting the SDMs, looking at their behavior, and how well they are able to predict future distributions, let’s predict the future (2021-2040) distribution of <em>Aquilegia formosa</em> under the Canada Earth Systems Model!</p>
<p>First, make predictions to the current climate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>Current_Bio_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Current_Bio, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>Current_Bio_df<span class="sc">$</span>pred_glm <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">predictSDM</span>(m_glm, Current_Bio_df)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>Current_Bio_df<span class="sc">$</span>pred_rf <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">predictSDM</span>(m_rf, Current_Bio_df)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>Current_Bio_df<span class="sc">$</span>pred_ens <span class="ot">&lt;-</span> <span class="fu">apply</span>(Current_Bio_df[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)], <span class="dv">1</span>, median)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make binary predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>Current_Bio_df<span class="sc">$</span>bin_glm <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Current_Bio_df<span class="sc">$</span>pred_glm <span class="sc">&gt;</span> eval_glm<span class="sc">$</span>thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>Current_Bio_df<span class="sc">$</span>bin_rf <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Current_Bio_df<span class="sc">$</span>pred_rf <span class="sc">&gt;</span> eval_rf<span class="sc">$</span>thresh, <span class="dv">1</span>, <span class="dv">0</span>) </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>Current_Bio_df<span class="sc">$</span>bin_ens <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Current_Bio_df<span class="sc">$</span>pred_ens <span class="sc">&gt;</span> eval_ens<span class="sc">$</span>thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make a raster stack of the predictions and plot!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>Raster_Current_Predictions <span class="ot">&lt;-</span> <span class="fu">rast</span>(Current_Bio_df[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)], <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Raster_Current_Predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For the future projections, we need to first assess novel environments under the climate change projections set by the model. Since moderate emission paths as well as a near future time period were chosen for this analysis, few novel environments are predicted to appear.</p>
<p>Assess novel environments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>bio_fut_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Future_Bio, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Values of 1 for the following mask indicate novel environments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>eo_mask <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">eo_mask</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  LastYearData_df[, pred], </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  bio_fut_df[, pred])</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>Raster_Future <span class="ot">&lt;-</span> <span class="fu">rast</span>(bio_fut_df[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)], <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Raster_Future, </span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Environmental Novelty"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Final_Complete_SDM_Analysis_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Very few novel environments are predicted, however looking closely, there are a couple at around (52 North, 130 West).</p>
<p>Now, make predictions to future climate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>pred_glm <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">predictSDM</span>(m_glm, bio_fut_df)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>pred_rf <span class="ot">&lt;-</span> mecofun<span class="sc">::</span><span class="fu">predictSDM</span>(m_rf, bio_fut_df)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>pred_ens <span class="ot">&lt;-</span> <span class="fu">apply</span>(bio_fut_df[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)], <span class="dv">1</span>, median)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, make binary predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>bin_glm <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bio_fut_df<span class="sc">$</span>pred_glm <span class="sc">&gt;</span> eval_glm<span class="sc">$</span>thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>bin_rf <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bio_fut_df<span class="sc">$</span>pred_rf <span class="sc">&gt;</span> eval_rf<span class="sc">$</span>thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>bio_fut_df<span class="sc">$</span>bin_ens <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bio_fut_df<span class="sc">$</span>pred_ens <span class="sc">&gt;</span> eval_ens<span class="sc">$</span>thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualize the predictions!</p>
<p>References:</p>
<p>Kumari, P., Wani, I. A., Khan, S., Verma, S., Mushtaq, S., Gulnaz, A., &amp; Paray, B. A. (2022). Modeling of Valeriana wallichii habitat suitability and niche dynamics in the Himalayan region under anticipated climate change. <em>Biology</em>, <em>11</em>(4), 498. https://doi.org/10.3390/biology11040498</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>